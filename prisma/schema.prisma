generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                     String                @id @default(uuid()) @db.Uuid
  email                  String                @unique
  password               String
  name                   String?
  last_name              String?
  created_at             DateTime              @default(now())
  updated_at             DateTime              @updatedAt
  role                   String?               @default("user")
  date_of_birth          DateTime?             @map("date_of_birth")
  gender                 String?
  goal_id                Int?
  height                 Float?
  weight                 Float?
  has_disability         Boolean?              @default(false) @map("has_disability")
  disability_description String?               @map("disability_description")
  bmi                    Float?
  routine_completions    routine_completions[]
  user_training_days     user_training_days[]
  goals                  goals?                @relation(fields: [goal_id], references: [id], onUpdate: NoAction, map: "fk_users_goal")

  @@index([goal_id], map: "idx_users_goal_id")
  @@map("users")
}

model MuscleGroup {
  id               String           @id @default(uuid()) @db.Uuid
  name             String           @unique
  description      String?
  created_at       DateTime         @default(now())
  updated_at       DateTime         @updatedAt
  name_en          String?
  exercise_muscles ExerciseMuscle[]
  exercises        Exercise[]

  @@map("muscle_groups")
}

model Exercise {
  id                String           @id @default(uuid()) @db.Uuid
  name              String
  description       String?
  muscle_group_id   String           @db.Uuid
  created_at        DateTime         @default(now())
  updated_at        DateTime         @updatedAt
  link_img          String?
  starting_position String?
  execution         String?
  tips              String[]
  equipment         String[]
  difficulty        String?          @db.VarChar(20)
  exercise_muscles  ExerciseMuscle[]
  muscle_group      MuscleGroup      @relation(fields: [muscle_group_id], references: [id], onDelete: Cascade)

  @@map("exercises")
}

model ExerciseMuscle {
  id              String      @id @default(uuid()) @db.Uuid
  exercise_id     String      @db.Uuid
  muscle_group_id String      @db.Uuid
  is_primary      Boolean     @default(false)
  created_at      DateTime    @default(now())
  exercise        Exercise    @relation(fields: [exercise_id], references: [id], onDelete: Cascade)
  muscle_group    MuscleGroup @relation(fields: [muscle_group_id], references: [id], onDelete: Cascade)

  @@unique([exercise_id, muscle_group_id])
  @@map("exercise_muscles")
}

model days_of_week {
  id                 Int                  @id
  name_en            String               @db.VarChar(10)
  name_es            String               @db.VarChar(10)
  short_name         String               @db.VarChar(3)
  routine_days       routine_days[]
  user_training_days user_training_days[]
}

model user_training_days {
  user_id String       @db.Uuid
  day_id  Int
  day     days_of_week @relation(fields: [day_id], references: [id])
  user    User         @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@id([user_id, day_id])
  @@map("user_training_days")
}

model routine_days {
  id           String        @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  routine_id   String?       @db.Uuid
  day_id       Int?
  created_at   DateTime?     @default(now()) @db.Timestamp(6)
  days_of_week days_of_week? @relation(fields: [day_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  routines     routines?     @relation(fields: [routine_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([routine_id, day_id])
}

model routine_exercises {
  id             String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  routine_id     String?   @db.Uuid
  exercise_id    String?   @db.Uuid
  order_position Int
  sets           Int?
  reps           Int?
  weight         Decimal?  @db.Decimal(10, 2)
  rest_time      Int?
  notes          String?
  created_at     DateTime? @default(now()) @db.Timestamp(6)
  routines       routines? @relation(fields: [routine_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

model routines {
  id                  String                @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name                String                @db.VarChar(255)
  description         String?
  user_id             String                @db.Uuid
  estimated_duration  Int?
  level               String?               @db.VarChar(50)
  goal                String?               @db.VarChar(50)
  is_active           Boolean?              @default(true)
  created_at          DateTime?             @default(now()) @db.Timestamp(6)
  updated_at          DateTime?             @default(now()) @db.Timestamp(6)
  completed_at        DateTime?             @db.Timestamp(6)
  is_completed        Boolean?              @default(false)
  routine_completions routine_completions[]
  routine_days        routine_days[]
  routine_exercises   routine_exercises[]
}

model goals {
  id          Int     @id @default(autoincrement())
  name        String  @unique @db.VarChar(50)
  description String?
  users       User[]
}

model routine_completions {
  id           String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  user_id      String   @db.Uuid
  routine_id   String   @db.Uuid
  completed_at DateTime @default(now()) @db.Timestamp(6)
  day_of_week  Int
  created_at   DateTime @default(now()) @db.Timestamp(6)
  routine      routines @relation(fields: [routine_id], references: [id], onDelete: Cascade)
  user         User     @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@index([user_id], map: "idx_routine_completions_user_id")
  @@index([routine_id], map: "idx_routine_completions_routine_id")
  @@index([completed_at], map: "idx_routine_completions_completed_at")
  @@map("routine_completions")
}
